<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ve√≠culo ‚Äì L100</title>

  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="css/home.css" />

  <!-- Firebase v9 (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

  <script defer src="js/firebase-config.js"></script>
  <script defer src="js/auth.js"></script>
  <script defer src="js/firestore.js"></script>
  <script defer src="js/veiculo.js"></script>
</head>

<body class="app-page" data-page="vehicle-detail">

  <!-- HEADER -->
  <header class="app-header">
    <div class="app-header-left">
      <a href="dashboard.html" class="app-logo" aria-label="Voltar √† dashboard">
        <svg class="icon" aria-hidden="true">
          <use href="assets/icons-unified.svg#icon-car"></use>
        </svg>
        <div class="app-logo-text">
          <span class="app-logo-title">L100</span>
          <span class="app-logo-subtitle">Detalhe do ve√≠culo</span>
        </div>
      </a>
    </div>

    <div class="app-header-actions">
      <a href="estatisticas.html" class="icon-btn" aria-label="Estat√≠sticas">
        <svg class="icon" aria-hidden="true"><use href="assets/icons-unified.svg#icon-dashboard"></use></svg>
      </a>

      <a href="perfil.html" class="icon-btn" aria-label="Perfil">
        <svg class="icon" aria-hidden="true"><use href="assets/icons-unified.svg#icon-user"></use></svg>
      </a>

      <button id="btn-logout" class="icon-btn" aria-label="Sair">
        <svg class="icon" aria-hidden="true"><use href="assets/icons-unified.svg#icon-logout"></use></svg>
      </button>
    </div>
  </header>

  <main class="home-main">

    <!-- CARD DO VE√çCULO -->
    <section class="card">
      <h1 class="page-title">
        <svg class="icon icon-title" aria-hidden="true">
          <use href="assets/icons-unified.svg#icon-car"></use>
        </svg>
        <span id="vehicle-name">Ve√≠culo</span>
      </h1>

      <p id="vehicle-subtitle" class="card-subtitle"></p>

      <div class="vehicle-detail-badges">
        <span id="vehicle-plate" class="badge badge-outline">-</span>
        <span id="vehicle-fuel" class="badge badge-secondary">-</span>
        <span id="vehicle-odometer" class="badge badge-outline">-</span>
      </div>

      <p id="vehicle-message" class="form-message"></p>
    </section>

    <!-- KPIs DO VE√çCULO -->
    <section class="stats-grid">
      <article class="stats-card">
        <div class="stats-card-header">
          <span class="stats-card-icon">
            <svg class="icon" aria-hidden="true"><use href="assets/icons-unified.svg#icon-wallet"></use></svg>
          </span>
          <h2>Total gasto</h2>
        </div>
        <p class="stats-card-value" id="kpi-gasto">‚Ç¨0,00</p>
        <p class="stats-card-desc">Neste ve√≠culo</p>
      </article>

      <article class="stats-card">
        <div class="stats-card-header">
          <span class="stats-card-icon">
            <svg class="icon" aria-hidden="true"><use href="assets/icons-unified.svg#icon-fuel"></use></svg>
          </span>
          <h2>Litros</h2>
        </div>
        <p class="stats-card-value" id="kpi-litros">0 L</p>
        <p class="stats-card-desc">Acumulado</p>
      </article>

      <article class="stats-card">
        <div class="stats-card-header">
          <span class="stats-card-icon">
            <svg class="icon" aria-hidden="true"><use href="assets/icons-unified.svg#icon-dashboard"></use></svg>
          </span>
          <h2>Consumo m√©dio</h2>
        </div>
        <p class="stats-card-value" id="kpi-consumo">-- L/100km</p>
        <p class="stats-card-desc">Estimado</p>
      </article>

      <article class="stats-card">
        <div class="stats-card-header">
          <span class="stats-card-icon">
            <svg class="icon" aria-hidden="true"><use href="assets/icons-unified.svg#icon-trend-up"></use></svg>
          </span>
          <h2>Custo por km</h2>
        </div>
        <p class="stats-card-value" id="kpi-custo-km">-- ‚Ç¨/km</p>
        <p class="stats-card-desc">Com base nos registos</p>
      </article>
    </section>

    <!-- TABS -->
    <nav class="section-tabs" aria-label="Sec√ß√µes do ve√≠culo">
      <button class="tab-btn is-active" type="button" data-tab="fuel" aria-controls="tab-fuel">
        <svg class="icon" aria-hidden="true"><use href="assets/icons-unified.svg#icon-fuel"></use></svg>
        <span>Abastecimentos</span>
      </button>

      <button class="tab-btn" type="button" data-tab="docs" aria-controls="tab-docs">
        <svg class="icon" aria-hidden="true"><use href="assets/icons-unified.svg#icon-file"></use></svg>
        <span>Documentos</span>
      </button>

      <button class="tab-btn" type="button" data-tab="maint" aria-controls="tab-maint">
        <svg class="icon" aria-hidden="true"><use href="assets/icons-unified.svg#icon-wrench"></use></svg>
        <span>Repara√ß√µes</span>
      </button>
    </nav>

    <!-- ABASTECIMENTOS -->
    <section id="tab-fuel" class="abastecimentos-section" style="margin-bottom: 32px;">
      <div class="card-header-row">
        <button id="btn-add-fuel" class="btn btn-primary btn-gradient" type="button">
          <svg class="icon icon-left" aria-hidden="true"><use href="assets/icons-unified.svg#icon-plus"></use></svg>
          <span>Novo abastecimento</span>
        </button>
      </div>

      <div id="fuel-empty" class="vehicles-empty hidden">
        <div class="vehicles-empty-icon">
          <svg class="icon" aria-hidden="true"><use href="assets/icons-unified.svg#icon-fuel"></use></svg>
        </div>
        <h3>Nenhum abastecimento</h3>
        <p>Registe o primeiro abastecimento deste ve√≠culo.</p>
      </div>

      <div id="fuel-list" class="fuel-list"></div>
    </section>

    <!-- DOCUMENTOS -->
    <section id="tab-docs" class="card hidden" style="margin-bottom:80px;">
      <header class="card-header">
        <h2 style="display:flex; gap:10px; align-items:center; margin:0;">
          <svg class="icon" aria-hidden="true"><use href="assets/icons-unified.svg#icon-file"></use></svg>
          <span>Documentos do ve√≠culo</span>
        </h2>
        <p class="muted">Guarda Documentos do carro e outros ficheiiros via link externo (Drive, OneDrive, etc.)</p>
      </header>

      <div class="card-body">

        <!-- FORM: Link externo -->
        <div class="card" style="margin:14px 0 0 0; padding:14px;">
          <div style="display:flex; flex-wrap:wrap; gap:12px; align-items:flex-end;">
            <div style="display:flex; flex-direction:column; gap:6px; min-width:200px;">
              <label class="muted" for="ext-tipo" style="font-size:12px;">Tipo</label>
              <select id="ext-tipo">
                <option value="DUA">DUA</option>
                <option value="Seguro">Seguro</option>
                <option value="Inspe√ß√£o">Inspe√ß√£o</option>
                <option value="IUC">IUC</option>
                <option value="Fatura">Fatura</option>
                <option value="Outro">Outro</option>
              </select>
            </div>

            <div style="display:flex; flex-direction:column; gap:6px; min-width:260px; flex:1;">
              <label class="muted" for="ext-url" style="font-size:12px;">Link externo (PDF/JPG)</label>
              <input id="ext-url" type="url" placeholder="https://drive.google.com/... ou https://..." inputmode="url" />
            </div>

            <div style="display:flex; flex-direction:column; gap:6px; min-width:220px;">
              <label class="muted" for="ext-titulo" style="font-size:12px;">Nome do documento</label>
              <input id="ext-titulo" type="text" placeholder="Ex.: Ap√≥lice Seguro 2025" />
            </div>

            <div style="display:flex; flex-direction:column; gap:6px; min-width:260px; flex:1;">
              <label class="muted" for="ext-nota" style="font-size:12px;">Nota (opcional)</label>
              <input id="ext-nota" type="text" placeholder="Ex.: v√°lido at√© 31/12/2025" />
            </div>

            <button id="btn-ext-save" type="button" class="btn btn-secondary" style="white-space:nowrap;">
              <svg class="icon icon-left" aria-hidden="true"><use href="assets/icons-unified.svg#icon-link"></use></svg>
              <span>Guardar link</span>
            </button>

            <span id="ext-msg" class="muted" style="min-width:140px;"></span>
          </div>

          <p class="muted" style="margin-top:10px; font-size:12px;">
            Dica: certifica-te que o link tem permiss√µes para abrir (ex.: ‚Äúqualquer pessoa com o link‚Äù).
          </p>
        </div>

        <!-- LISTA -->
        <div style="margin-top:16px; display:flex; align-items:center; justify-content:space-between; gap:12px;">
          <h3 style="margin:0; display:flex; gap:10px; align-items:center;">
            <svg class="icon" aria-hidden="true"><use href="assets/icons-unified.svg#icon-folder"></use></svg>
            <span>Documentos guardados</span>
          </h3>

          <div style="display:flex; gap:10px; align-items:center;">
            <span class="muted" style="font-size:12px;">Filtrar:</span>
            <select id="docs-filter">
              <option value="Todos">Todos</option>
              <option value="Carro">Documentos do carro</option>
              <option value="Outros">Outros</option>
            </select>
          </div>
        </div>

        <div id="docs-list" style="margin-top:12px; display:grid; gap:12px;"></div>
      </div>
    </section>

    <!-- REPARA√á√ïES (placeholder) -->
    <section id="tab-maint" class="card hidden" style="margin-bottom:80px;">
      <header class="card-header">
        <h2 style="display:flex; gap:10px; align-items:center; margin:0;">
          <svg class="icon" aria-hidden="true"><use href="assets/icons-unified.svg#icon-wrench"></use></svg>
          <span>Repara√ß√µes</span>
        </h2>
        <p class="muted">Regista manuten√ß√µes, repara√ß√µes e custos associados.</p>
        <div class="card-header-row">
          <button id="btn-add-maint" class="btn btn-primary btn-gradient" type="button">
            <svg class="icon icon-left"><use href="assets/icons-unified.svg#icon-plus"></use></svg>
            <span>Nova repara√ß√£o</span>
          </button>
        </div>

      </header>
        <div class="card-body">

          <!-- EMPTY STATE -->
          <div id="maint-empty" class="vehicles-empty" style="margin:0;">
            <div class="vehicles-empty-icon">üõ†Ô∏è</div>
            <h3>Nenhuma repara√ß√£o</h3>
            <p>Regista a primeira repara√ß√£o para acompanhar custos e hist√≥rico.</p>
          </div>

          <!-- LISTA DE REPARA√á√ïES -->
          <div id="maint-list" style="display:grid; gap:12px;"></div>

        </div>
    </section>
  </main>

  <!-- FOOTER -->
  <footer>
    <a href="dashboard.html">
      <svg class="icon" aria-hidden="true"><use href="assets/icons-unified.svg#icon-home"></use></svg>
      <span>Home</span>
    </a>
    <a href="abastecimentos.html">
      <svg class="icon" aria-hidden="true"><use href="assets/icons-unified.svg#icon-fuel"></use></svg>
      <span>Abastecer</span>
    </a>
    <a href="veiculos.html" class="active">
      <svg class="icon" aria-hidden="true"><use href="assets/icons-unified.svg#icon-car"></use></svg>
      <span>Ve√≠culos</span>
    </a>
    <a href="perfil.html">
      <svg class="icon" aria-hidden="true"><use href="assets/icons-unified.svg#icon-user"></use></svg>
      <span>Perfil</span>
    </a>
  </footer>

  <!-- MODAL: NOVA REPARA√á√ÉO -->
  <div id="maint-modal" class="modal hidden">
        <div class="modal-overlay"></div>

        <div class="modal-card">
          <header class="modal-header">
            <h2>
              <svg class="icon"><use href="assets/icons-unified.svg#icon-wrench"></use></svg>
              Nova repara√ß√£o
            </h2>
            <button id="maint-close" class="icon-btn">
              <svg class="icon"><use href="assets/icons-unified.svg#icon-close"></use></svg>
            </button>
          </header>

          <div class="modal-body">
            <div class="form-grid">

              <label>
                <span class="muted">Descri√ß√£o</span>
                <input id="rep-desc" type="text" placeholder="Ex.: Troca de √≥leo" />
              </label>

              <label>
                <span class="muted">Data</span>
                <input id="rep-date" type="date" />
              </label>

              <label>
                <span class="muted">Quil√≥metros</span>
                <input id="rep-km" type="number" placeholder="123456" />
              </label>

              <label>
                <span class="muted">Custo (‚Ç¨)</span>
                <input id="rep-cost" type="number" step="0.01" placeholder="89.90" />
              </label>

              <label style="grid-column:1/-1;">
                <span class="muted">Oficina</span>
                <input id="rep-shop" type="text" placeholder="Nome da oficina (opcional)" />
              </label>

            </div>

            <p id="rep-msg" class="muted"></p>
          </div>

          <footer class="modal-footer">
            <button id="rep-cancel" class="btn btn-secondary">Cancelar</button>
            <button id="rep-save" class="btn btn-primary btn-gradient">
              Guardar repara√ß√£o
            </button>
          </footer>
        </div>
  </div>

</body>
</html>
